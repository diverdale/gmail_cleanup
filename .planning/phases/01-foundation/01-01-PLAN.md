---
phase: 01-foundation
plan: "01"
type: execute
wave: 1
depends_on: []
files_modified:
  - .gitignore
  - .python-version
  - pyproject.toml
  - uv.lock
autonomous: true
requirements:
  - AUTH-01

must_haves:
  truths:
    - "Running git status shows credentials.json, token.json, client_id, client_secret as ignored — they never appear as untracked files"
    - "uv sync completes without error and installs all dependencies"
    - "python --version reports 3.12.x inside the uv environment"
  artifacts:
    - path: ".gitignore"
      provides: "Credential file protection for all OAuth secrets"
      contains: "credentials.json"
    - path: ".python-version"
      provides: "Python version pin for uv"
      contains: "3.12"
    - path: "pyproject.toml"
      provides: "Project metadata, dependencies, and gmail-clean entry point"
      contains: "gmail-clean"
  key_links:
    - from: ".gitignore"
      to: "credentials.json, client_id, client_secret"
      via: "git rm --cached + gitignore pattern"
      pattern: "credentials\\.json"
    - from: "pyproject.toml"
      to: "gmail_cleanup.main:app"
      via: "[project.scripts] entry point"
      pattern: "gmail-clean"
---

<objective>
Establish security baseline and project skeleton: protect credential files from git, fix the broken .python-version, and install all dependencies via uv.

Purpose: Every subsequent plan depends on credentials being protected and the uv environment being functional. This plan has no dependencies — it must run first.
Output: .gitignore, corrected .python-version, pyproject.toml, uv.lock
</objective>

<execution_context>
@/Users/dalwrigh/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dalwrigh/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Protect credentials and fix Python version</name>
  <files>.gitignore, .python-version</files>
  <action>
    CRITICAL ORDER: .gitignore must exist before any git operation.

    Step 1 — Create .gitignore with this exact content:
    ```
    # OAuth credentials — NEVER commit these
    credentials.json
    token.json
    client_id
    client_secret
    client_secret*.json

    # Python
    __pycache__/
    *.py[cod]
    .venv/
    *.egg-info/
    dist/
    .uv/

    # Environment
    .env
    ```

    Step 2 — Fix .python-version. Current content is "gmail_cleanup" (wrong — uv requires a version number). Replace entire file content with the single line:
    ```
    3.12
    ```

    Step 3 — Un-track credential files already in git. These files exist in the project root and may be tracked. Run:
    ```bash
    git rm --cached credentials.json client_id client_secret 2>/dev/null || true
    ```
    The `|| true` prevents failure if they are not currently tracked. Do NOT delete the actual files — only remove from git tracking.

    Step 4 — Verify gitignore is working:
    ```bash
    git status
    ```
    credentials.json, client_id, client_secret must NOT appear in the output at all (neither staged nor untracked). If any appear as untracked, the .gitignore is not working — check for typos in the filenames.
  </action>
  <verify>
    Run: git status
    Expected: credentials.json, client_id, and client_secret do NOT appear anywhere in the output.
    Run: cat .python-version
    Expected: outputs exactly "3.12" (no other text).
  </verify>
  <done>
    git status shows no credential files. .python-version contains "3.12". .gitignore exists with all credential patterns.
  </done>
</task>

<task type="auto">
  <name>Task 2: Initialize uv project and install dependencies</name>
  <files>pyproject.toml, uv.lock</files>
  <action>
    The project has no pyproject.toml yet. Create it with this exact content (do NOT run `uv init` — that would overwrite directory structure; write the file directly):

    ```toml
    [project]
    name = "gmail-cleanup"
    version = "0.1.0"
    description = "Delete old Gmail messages reliably from the command line"
    requires-python = ">=3.12"
    dependencies = [
        "google-api-python-client==2.190.0",
        "google-auth==2.48.0",
        "google-auth-oauthlib==1.2.4",
        "google-auth-httplib2",
        "typer==0.24.0",
        "rich==14.1.0",
        "python-dateutil",
    ]

    [project.scripts]
    gmail-clean = "gmail_cleanup.main:app"

    [build-system]
    requires = ["hatchling"]
    build-backend = "hatchling.build"
    ```

    Note: typer and rich are installed now (not Phase 2) so the lock file is stable for all phases. python-dateutil is unpinned — use whatever uv resolves.

    Then run:
    ```bash
    uv sync
    ```

    This creates .venv/ and uv.lock. If uv reports "No interpreter found", verify .python-version contains "3.12" (from Task 1).

    Do NOT add .venv/ or uv.lock to .gitignore — uv.lock should be committed (it's a lockfile, not a secret).
  </action>
  <verify>
    Run: uv run python -c "import googleapiclient; import google.auth; import google_auth_oauthlib; print('OK')"
    Expected: prints "OK" with no errors.
    Run: uv run python --version
    Expected: Python 3.12.x
  </verify>
  <done>
    pyproject.toml exists with all dependencies listed and gmail-clean entry point defined. uv sync completes without error. All three google libraries importable via uv run python.
  </done>
</task>

</tasks>

<verification>
Run both checks:
1. git status — credentials.json, token.json, client_id, client_secret must be absent from all output sections (not tracked, not untracked, not staged)
2. uv run python -c "import googleapiclient; import google.auth; import google_auth_oauthlib; print('imports OK')" — must print "imports OK"
</verification>

<success_criteria>
- .gitignore exists and actively protects all four credential file names
- .python-version contains exactly "3.12"
- pyproject.toml exists with gmail-clean entry point and all dependencies
- uv sync has run and .venv/ is populated
- All google-auth and google-api-python-client libraries are importable in the uv environment
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>
